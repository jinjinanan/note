# 华人神器

- UI问题
- This app is not allowed to query for scheme xxx
- 支付
- 状态栏

## UI问题
|  问题   | 解决  |
|  ----  | ----  |
| 字体的内边距  | 字体的内边距一般要累计-1 |
| 设计图的尺寸和项目里的缩放因子的分母  | 项目里的缩放因子的分母要和设计图的大小是一致的 |
|字体大小的缩放|缩放因子要用H来做分母|

## This app is not allowed to query for scheme xxx

### 原因

从iOS 9 开始，涉及到平台客户端的跳转，系统会自动到 info.plist 下检查是否设置Scheme。如果没有做相应的配置，就无法跳转到相应的客户端。因此如果客户端集成有分享与授权，需要配置Scheme白名单（LSApplicationQueriesSchemes）


### 解决

1. 在 info.plist 增加 key：LSApplicationQueriesSchemes，类型为NSArray。
2. 添加需要支持的白名单，类型为String。

> 微信的跳转
> ```
><key>LSApplicationQueriesSchemes</key>
><array>
>    <string>weixinULAPI</string>
>    <string>weixin</string>
>    <string>fb-messenger-share-api</string>
></array>
>```

## 支付

### 支付宝和微信的流程

1. App 发起一笔支付交易，然后服务端根据支付宝的要求把订单信息进行加密签名
2. 服务端把加密的交易信息返回给 App，App 拿到交易信息调用支付宝的 SDK，把支付信息给到支付宝的服务端验证
3. 验证通过后，App 跳转到支付宝 App 或者网页版支付宝，用户使用支付宝进行支付
4. 支付成功后从支付宝 App 跳转回到我们自己 APP，我们在 App 里处理回调结果刷新UI等
5. 同时支付宝的服务器也会回调我们自己服务器，把收据传给服务器，支付宝服务器会一直回调我们的服务器直到我们的服务器确认收到收据
6. 我们的服务器收到回调确认之后，确认订单支付成功
为了以防万一，App 上回调返回成功之后我们还需要去自己服务器验证是否真的支付成功（一切以服务器为准）

### IAP流程

1. App 发起一笔内购支付，然后服务端生成一个订单号并且返回给 App
2. App 拿到交易订单之后调用 IPA 创建一个 IPA 交易，并且添加到支付队列
3. 然后 IAP 会调用 Apple ID 支付页面等待用户确认支付，IPA 和苹果自己的 IPA 服务器通讯，回调购买成功，并且把收据写入 App 沙盒
4. 然后 App 去沙盒获取收据并且上传到自己的服务器
服务器去 IAP 服务器查询收据的有效性并且对应到某个订单号，如果有效就通知 App，并且发放该内购商品，App 调用IAP 支付队列去结束该 IPA 交易

## 状态栏

### 启动期间状态栏的控制

设置路径
Targets -> 对应项目 -> General -> Status Bar Style

### 设置各个VC的状态栏是否相互影响

1. info.plist
2. View controller-based status bar appearance 属性
3. YES 每个VC的状态栏各自独立； NO 每个VC的状态栏互相影响

### 状态栏样式重写

>@available(iOS 7.0, *)
>    open var preferredStatusBarStyle: UIStatusBarStyle { get }

### 状态栏隐藏

>  @available(iOS 7.0, *)
>    open var prefersStatusBarHidden: Bool { get }

