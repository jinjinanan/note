# 架构和框架

- 图片缓存
- 阅读时长统计
- 复杂页面架构
- 客户端整体架构

框架和架构解决的问题

- 模块化
- 结构
- 结偶
- 降低代码的重合度

## 怎样设计一个图片缓存框架

![img1](../../../Sources/IMG_0740.jpg)

### 图片通过什么方式进行读写，过程是怎样的？

- 以图片的URL的单向Hash值作为key

流程

![img2](../../../Sources/IMG_57643C88B6E7-1.jpeg)

### 内存的设计需要考虑哪些问题

- 内存的size
- 淘汰策略

#### 内存的size如何设计

![img3](../../../Sources/IMG_0C72F9C13E36-1.jpeg)

#### 淘汰策略

- 以队列先进先出的方式淘汰
- LRU算法(如30分钟之内未使用)
  - 定时检查(不推荐)
  - 提高检查触发频率
    - 每次进行读写时
    - 前后台切换时

Note:注意时间和空间的开销

### 磁盘的设计

#### 磁盘设计需要考虑哪些问题？

- 存储方式
- 存储大小（如100M）
- 淘汰策略

### 网络部分

- 图片请求的最大并发量
- 请求超时策略
- 请求优先级

### 图片解码

#### 对于不同格式的图片，解码采用什么方式来做

- 应用策略模式对不同图片格式进行解码

#### 在哪个阶段做图片解码处理

- 磁盘读取后
- 网络请求返回后

### 线程处理

![img4](../../../Sources/IMG_25D5ED2F9712-1.jpeg)

## 阅读时长统计

![img5](../../../Sources/IMG_DDA155F2854A-1.jpeg)

### 为何要有不同类型的记录器，你的考虑是什么

- 基于不同分类场景提供的关于记录的封装，适配

### 记录的数据会由于某种原因丢失，你是怎么处理的？

- 定时写磁盘
- 限定内存缓存条数，超过该条数，即可写磁盘

### 关于延时上传的具体场景有哪些

- 前后台切换
- 从无网到有网
- 通用轻量接口捎带 （不推荐）

### 上传时机是怎么把握的

- 立刻上传
- 延时上传
- 定时上传

## 复杂页面架构总结

MVVM框架思想
ReactNative的数据流思想
系统UIView更新机制的思想（脏标记）
Facebook的开源框架AsyncDisplayKit关于预排版的设计思想

### MVVM

![img](../../../Sources/IMG_2A246B2F91FF-1.jpeg)

### ReactNative的数据流思想

![img](../../../Sources/IMG_C413F8ED33FB-1.jpeg)

子节点页面需要更新，打上脏标记，需要从根页面自顶向下更新子界面（从主动行为变为被动行为）

## 客户端整体架构

![img](../../../Sources/IMG_A7E97A593FD8-1.jpeg)

### 业务之间的解耦通信方式

- OpenURL
- 依赖注入

依赖注入

![img](../../../Sources/IMG_B9F6E69A2019-1.jpeg)
